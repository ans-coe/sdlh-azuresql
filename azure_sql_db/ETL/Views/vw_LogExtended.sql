
CREATE VIEW [ETL].[vw_LogExtended] AS
SELECT L.[LOG_ID]
    ,L.[SOURCE_TYPE]
    ,L.[SOURCE_SYSTEM]
    ,L.[SOURCE_GROUPING_ID]
    ,L.[OBJECT_NAME]
    ,J.[LOAD_TYPE]
    ,L.[DATABASE_NAME]
    ,L.[SCHEMA_NAME]
    ,L.[TABLE_NAME]
    ,L.[TRIGGER_TIME]
    ,L.[TRIGGER_TYPE]
    ,L.[PIPELINE_RUN_ID]
    ,L.[PIPELINE_NAME]
    ,L.[TRIGGERING_PIPELINE_RUN_ID]
    ,L.[TRIGGERING_PIPELINE_NAME]
    ,L.[OPERATION]
    ,L.[COMPONENT_NAME]
    ,L.[TARGET_SYSTEM]
    ,J.[SERVERLESS_SQL_POOL_DATABASE] AS [TAGET_LAKEHOUSE_DATABASE]
    ,J.[SERVERLESS_SQL_POOL_SCHEMA] AS [TAGET_LAKEHOUSE_SCHEMA]
    ,L.[START_TIME]
    ,L.[END_TIME]
    ,L.[DURATION_SECONDS]
    ,L.[INSERTS]
    ,L.[UPDATES]
    ,L.[DELETES]
    ,L.[ERROR_MESSAGE]
    ,L.[NEW_INCREMENTAL_KEY_VALUE]
    ,L.[PREVIOUS_INCREMENTAL_KEY_VALUE]
FROM [ETL].[Log] L
LEFT JOIN [ETL].[JsonMetadata] J
    ON L.[SOURCE_TYPE] = J.[SOURCE_TYPE]
    AND L.[SOURCE_SYSTEM] = J.[SOURCE_SYSTEM]
    AND L.[OBJECT_NAME] = J.[OBJECT_NAME]
ORDER BY L.[TRIGGER_TIME] DESC, L.[OBJECT_NAME]
OFFSET 0 ROWS